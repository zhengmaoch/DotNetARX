# ğŸ¯ æ–°æ¡†æ¶ä¸‹çš„AddLayeræ–¹æ³•è°ƒç”¨ç¤ºä¾‹

## ğŸ“ **å¤šç§è°ƒç”¨æ–¹å¼å¯¹æ¯”**

### 1. **åŸæœ‰æ–¹æ³•è°ƒç”¨ï¼ˆ100%å‘åå…¼å®¹ï¼‰**
```csharp
using DotNetARX;

// âœ… åŸæœ‰æ–¹æ³•ç»§ç»­æœ‰æ•ˆï¼Œæ— éœ€ä¿®æ”¹
var db = HostApplicationServices.WorkingDatabase;
var layerId = db.AddLayer("MyNewLayer");
```

### 2. **æ–°æ¡†æ¶ç»Ÿä¸€APIè°ƒç”¨ï¼ˆæ¨èï¼‰**
```csharp
using DotNetARX;

// ğŸš€ æ–°çš„ç»Ÿä¸€API - åŠŸèƒ½æ›´å¼ºå¤§
var layerId = ARX.ARXLayer.Create("MyNewLayer", colorIndex: 2); // é»„è‰²å›¾å±‚

// è®¾ç½®ä¸ºå½“å‰å›¾å±‚
ARX.ARXLayer.SetCurrent("MyNewLayer");

// æ£€æŸ¥å›¾å±‚æ˜¯å¦å­˜åœ¨
if (ARX.ARXLayer.Exists("MyNewLayer"))
{
    ARX.Logger.Info("å›¾å±‚åˆ›å»ºæˆåŠŸ");
}
```

### 3. **å¿«æ·APIè°ƒç”¨ï¼ˆæœ€ç®€æ´ï¼‰**
```csharp
using static DotNetARX.CAD;

// âš¡ æœ€ç®€æ´çš„è°ƒç”¨æ–¹å¼
var layerId = Layer.Create("MyLayer", 3); // ç»¿è‰²å›¾å±‚
Layer.SetCurrent("MyLayer");
Layer.SetColor("MyLayer", 1); // æ”¹ä¸ºçº¢è‰²
```

## ğŸ› ï¸ **é«˜çº§åŠŸèƒ½ç¤ºä¾‹**

### æ‰¹é‡å›¾å±‚æ“ä½œ
```csharp
using DotNetARX;

// åˆå§‹åŒ–æ¡†æ¶
ARX.Initialize();

// åˆ›å»ºå¤šä¸ªå›¾å±‚
var layerConfigs = new[]
{
    new { Name = "å»ºç­‘", Color = (short)1 },  // çº¢è‰²
    new { Name = "ç»“æ„", Color = (short)2 },  // é»„è‰²
    new { Name = "è®¾å¤‡", Color = (short)3 },  // ç»¿è‰²
    new { Name = "ç”µæ°”", Color = (short)4 },  // é’è‰²
};

foreach (var config in layerConfigs)
{
    var layerId = ARX.ARXLayer.Create(config.Name, config.Color);
    ARX.Logger.Info($"åˆ›å»ºå›¾å±‚: {config.Name}, ID: {layerId}");
}

// è·å–æ‰€æœ‰å›¾å±‚åç§°
var allLayers = ARX.ARXLayer.GetNames();
ARX.Logger.Info($"æ€»å…±æœ‰ {allLayers.Count()} ä¸ªå›¾å±‚");
```

### å¸¦äº‹ä»¶å¤„ç†çš„å›¾å±‚æ“ä½œ
```csharp
using DotNetARX;

// è®¢é˜…å›¾å±‚äº‹ä»¶
CADEventManager.LayerCreated += async args =>
{
    ARX.Logger.Info($"å›¾å±‚å·²åˆ›å»º: {args.LayerName}");
    
    // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ åç»­å¤„ç†é€»è¾‘
    // æ¯”å¦‚è‡ªåŠ¨è®¾ç½®å›¾å±‚å±æ€§ã€é€šçŸ¥å…¶ä»–ç³»ç»Ÿç­‰
};

// åˆ›å»ºå›¾å±‚æ—¶ä¼šè‡ªåŠ¨è§¦å‘äº‹ä»¶
var layerId = ARX.ARXLayer.Create("æµ‹è¯•å›¾å±‚", 5);
```

### ä½¿ç”¨æ€§èƒ½ç›‘æ§çš„å›¾å±‚æ“ä½œ
```csharp
using DotNetARX;

// ç›‘æ§å›¾å±‚æ“ä½œæ€§èƒ½
ARX.WithPerformanceMonitoring(() =>
{
    // æ‰¹é‡åˆ›å»ºå›¾å±‚
    for (int i = 1; i <= 100; i++)
    {
        ARX.ARXLayer.Create($"å›¾å±‚{i:D3}", (short)(i % 7 + 1));
    }
}, "æ‰¹é‡åˆ›å»ºå›¾å±‚", "LayerOperations");

// æŸ¥çœ‹æ€§èƒ½æŠ¥å‘Š
var report = ARX.Performance.GenerateReport();
ARX.Logger.Info(report);
```

### å¸¦å¼‚å¸¸å¤„ç†çš„å®‰å…¨å›¾å±‚æ“ä½œ
```csharp
using DotNetARX;

// å®‰å…¨çš„å›¾å±‚åˆ›å»º
var success = CADExceptionHandler.ExecuteWithExceptionHandling(() =>
{
    var layerId = ARX.ARXLayer.Create("é‡è¦å›¾å±‚", 1);
    ARX.ARXLayer.SetCurrent("é‡è¦å›¾å±‚");
    return true;
}, false);

if (success)
{
    ARX.Logger.Info("å›¾å±‚æ“ä½œå®Œæˆ");
}
else
{
    ARX.Logger.Error("å›¾å±‚æ“ä½œå¤±è´¥");
}
```

## ğŸ“Š **å›¾å±‚ç®¡ç†å®Œæ•´ç¤ºä¾‹**

```csharp
using System;
using System.Linq;
using DotNetARX;
using static DotNetARX.CAD;

namespace MyCADPlugin
{
    public class LayerManagementExample
    {
        public void DemoLayerOperations()
        {
            // åˆå§‹åŒ–DotNetARX
            ARX.Initialize();
            
            Log.Info("å¼€å§‹å›¾å±‚ç®¡ç†æ¼”ç¤º");

            try
            {
                // 1. åˆ›å»ºåŸºç¡€å›¾å±‚
                CreateBasicLayers();
                
                // 2. è®¾ç½®å›¾å±‚å±æ€§
                ConfigureLayerProperties();
                
                // 3. å›¾å±‚çŠ¶æ€ç®¡ç†
                ManageLayerStates();
                
                // 4. è·å–å›¾å±‚ä¿¡æ¯
                DisplayLayerInfo();
                
                // 5. æ¸…ç†æµ‹è¯•å›¾å±‚
                CleanupTestLayers();
                
                Log.Info("å›¾å±‚ç®¡ç†æ¼”ç¤ºå®Œæˆ");
            }
            catch (Exception ex)
            {
                Log.Error("å›¾å±‚ç®¡ç†æ¼”ç¤ºå¤±è´¥", ex);
            }
        }

        private void CreateBasicLayers()
        {
            Log.Info("=== åˆ›å»ºåŸºç¡€å›¾å±‚ ===");
            
            var layerConfigs = new[]
            {
                new { Name = "0-å¤–æ¡†", Color = 7 },
                new { Name = "1-ä¸­å¿ƒçº¿", Color = 2 },
                new { Name = "2-æ ‡æ³¨", Color = 1 },
                new { Name = "3-æ–‡å­—", Color = 3 },
                new { Name = "4-å¡«å……", Color = 4 }
            };

            foreach (var config in layerConfigs)
            {
                using (Perf.Timer($"åˆ›å»ºå›¾å±‚_{config.Name}"))
                {
                    var layerId = Layer.Create(config.Name, (short)config.Color);
                    Log.Info($"åˆ›å»ºå›¾å±‚: {config.Name} (é¢œè‰²: {config.Color}) - ID: {layerId}");
                }
            }
        }

        private void ConfigureLayerProperties()
        {
            Log.Info("=== é…ç½®å›¾å±‚å±æ€§ ===");
            
            // è®¾ç½®ä¸åŒçš„å›¾å±‚çŠ¶æ€
            Layer.Lock("1-ä¸­å¿ƒçº¿");        // é”å®šä¸­å¿ƒçº¿å›¾å±‚
            Layer.Freeze("4-å¡«å……");        // å†»ç»“å¡«å……å›¾å±‚
            Layer.SetColor("2-æ ‡æ³¨", 1);   // è®¾ç½®æ ‡æ³¨å›¾å±‚ä¸ºçº¢è‰²
            
            Log.Info("å›¾å±‚å±æ€§é…ç½®å®Œæˆ");
        }

        private void ManageLayerStates()
        {
            Log.Info("=== å›¾å±‚çŠ¶æ€ç®¡ç† ===");
            
            // è®¾ç½®å½“å‰å›¾å±‚
            if (Layer.Exists("0-å¤–æ¡†"))
            {
                Layer.SetCurrent("0-å¤–æ¡†");
                Log.Info("å½“å‰å›¾å±‚è®¾ç½®ä¸º: 0-å¤–æ¡†");
            }
            
            // è§£é”å›¾å±‚
            Layer.Unlock("1-ä¸­å¿ƒçº¿");
            Log.Info("ä¸­å¿ƒçº¿å›¾å±‚å·²è§£é”");
            
            // è§£å†»å›¾å±‚
            Layer.Thaw("4-å¡«å……");
            Log.Info("å¡«å……å›¾å±‚å·²è§£å†»");
        }

        private void DisplayLayerInfo()
        {
            Log.Info("=== å›¾å±‚ä¿¡æ¯ç»Ÿè®¡ ===");
            
            var allLayerNames = Layer.GetNames().ToList();
            Log.Info($"æ€»å›¾å±‚æ•°: {allLayerNames.Count}");
            
            foreach (var layerName in allLayerNames.Where(name => name.StartsWith("0-") || name.StartsWith("1-")))
            {
                Log.Info($"å›¾å±‚: {layerName}");
            }
        }

        private void CleanupTestLayers()
        {
            Log.Info("=== æ¸…ç†æµ‹è¯•å›¾å±‚ ===");
            
            var testLayers = new[] { "1-ä¸­å¿ƒçº¿", "2-æ ‡æ³¨", "3-æ–‡å­—", "4-å¡«å……" };
            
            foreach (var layerName in testLayers)
            {
                if (Layer.Exists(layerName))
                {
                    var deleted = Layer.Delete(layerName);
                    Log.Info($"åˆ é™¤å›¾å±‚ {layerName}: {(deleted ? "æˆåŠŸ" : "å¤±è´¥")}");
                }
            }
        }
    }
}
```

## ğŸ¯ **ä½¿ç”¨å»ºè®®**

### âœ… **æ¨èçš„ä½¿ç”¨æ¨¡å¼**

1. **æ–°é¡¹ç›®**: ä¼˜å…ˆä½¿ç”¨ `ARX.ARXLayer.*` ç»Ÿä¸€API
2. **ç°æœ‰é¡¹ç›®**: ä¿æŒåŸæœ‰ä»£ç ä¸å˜ï¼Œæ–°åŠŸèƒ½ä½¿ç”¨æ–°API
3. **æ€§èƒ½å…³é”®**: ä½¿ç”¨æ€§èƒ½ç›‘æ§åŒ…è£…é‡è¦æ“ä½œ
4. **ä¼ä¸šåº”ç”¨**: ç»“åˆäº‹ä»¶ç³»ç»Ÿå®ç°ä¸šåŠ¡é€»è¾‘

### ğŸš€ **ç«‹å³ä½“éªŒ**

```csharp
// æœ€ç®€å•çš„å¼€å§‹æ–¹å¼
using DotNetARX;

// ä¸€è¡Œä»£ç åˆ›å»ºå›¾å±‚
var layerId = ARX.ARXLayer.Create("æˆ‘çš„å›¾å±‚", 2);

// ä¸€è¡Œä»£ç è®¾ç½®å½“å‰å›¾å±‚  
ARX.ARXLayer.SetCurrent("æˆ‘çš„å›¾å±‚");

// å®Œæˆï¼
```

---

**æ–°æ¡†æ¶æä¾›äº†å‘åå…¼å®¹çš„åŒæ—¶ï¼Œè¿˜å¢åŠ äº†æ›´å¼ºå¤§çš„åŠŸèƒ½ï¼šæ€§èƒ½ç›‘æ§ã€äº‹ä»¶å¤„ç†ã€å¼‚å¸¸ç®¡ç†ã€æ—¥å¿—è®°å½•ç­‰ä¼ä¸šçº§ç‰¹æ€§ã€‚**