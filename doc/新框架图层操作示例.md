# 🎯 新框架下的AddLayer方法调用示例

## 📝 **多种调用方式对比**

### 1. **原有方法调用（100%向后兼容）**
```csharp
using DotNetARX;

// ✅ 原有方法继续有效，无需修改
var db = HostApplicationServices.WorkingDatabase;
var layerId = db.AddLayer("MyNewLayer");
```

### 2. **新框架统一API调用（推荐）**
```csharp
using DotNetARX;

// 🚀 新的统一API - 功能更强大
var layerId = ARX.ARXLayer.Create("MyNewLayer", colorIndex: 2); // 黄色图层

// 设置为当前图层
ARX.ARXLayer.SetCurrent("MyNewLayer");

// 检查图层是否存在
if (ARX.ARXLayer.Exists("MyNewLayer"))
{
    ARX.Logger.Info("图层创建成功");
}
```

### 3. **快捷API调用（最简洁）**
```csharp
using static DotNetARX.CAD;

// ⚡ 最简洁的调用方式
var layerId = Layer.Create("MyLayer", 3); // 绿色图层
Layer.SetCurrent("MyLayer");
Layer.SetColor("MyLayer", 1); // 改为红色
```

## 🛠️ **高级功能示例**

### 批量图层操作
```csharp
using DotNetARX;

// 初始化框架
ARX.Initialize();

// 创建多个图层
var layerConfigs = new[]
{
    new { Name = "建筑", Color = (short)1 },  // 红色
    new { Name = "结构", Color = (short)2 },  // 黄色
    new { Name = "设备", Color = (short)3 },  // 绿色
    new { Name = "电气", Color = (short)4 },  // 青色
};

foreach (var config in layerConfigs)
{
    var layerId = ARX.ARXLayer.Create(config.Name, config.Color);
    ARX.Logger.Info($"创建图层: {config.Name}, ID: {layerId}");
}

// 获取所有图层名称
var allLayers = ARX.ARXLayer.GetNames();
ARX.Logger.Info($"总共有 {allLayers.Count()} 个图层");
```

### 带事件处理的图层操作
```csharp
using DotNetARX;

// 订阅图层事件
CADEventManager.LayerCreated += async args =>
{
    ARX.Logger.Info($"图层已创建: {args.LayerName}");
    
    // 可以在这里添加后续处理逻辑
    // 比如自动设置图层属性、通知其他系统等
};

// 创建图层时会自动触发事件
var layerId = ARX.ARXLayer.Create("测试图层", 5);
```

### 使用性能监控的图层操作
```csharp
using DotNetARX;

// 监控图层操作性能
ARX.WithPerformanceMonitoring(() =>
{
    // 批量创建图层
    for (int i = 1; i <= 100; i++)
    {
        ARX.ARXLayer.Create($"图层{i:D3}", (short)(i % 7 + 1));
    }
}, "批量创建图层", "LayerOperations");

// 查看性能报告
var report = ARX.Performance.GenerateReport();
ARX.Logger.Info(report);
```

### 带异常处理的安全图层操作
```csharp
using DotNetARX;

// 安全的图层创建
var success = CADExceptionHandler.ExecuteWithExceptionHandling(() =>
{
    var layerId = ARX.ARXLayer.Create("重要图层", 1);
    ARX.ARXLayer.SetCurrent("重要图层");
    return true;
}, false);

if (success)
{
    ARX.Logger.Info("图层操作完成");
}
else
{
    ARX.Logger.Error("图层操作失败");
}
```

## 📊 **图层管理完整示例**

```csharp
using System;
using System.Linq;
using DotNetARX;
using static DotNetARX.CAD;

namespace MyCADPlugin
{
    public class LayerManagementExample
    {
        public void DemoLayerOperations()
        {
            // 初始化DotNetARX
            ARX.Initialize();
            
            Log.Info("开始图层管理演示");

            try
            {
                // 1. 创建基础图层
                CreateBasicLayers();
                
                // 2. 设置图层属性
                ConfigureLayerProperties();
                
                // 3. 图层状态管理
                ManageLayerStates();
                
                // 4. 获取图层信息
                DisplayLayerInfo();
                
                // 5. 清理测试图层
                CleanupTestLayers();
                
                Log.Info("图层管理演示完成");
            }
            catch (Exception ex)
            {
                Log.Error("图层管理演示失败", ex);
            }
        }

        private void CreateBasicLayers()
        {
            Log.Info("=== 创建基础图层 ===");
            
            var layerConfigs = new[]
            {
                new { Name = "0-外框", Color = 7 },
                new { Name = "1-中心线", Color = 2 },
                new { Name = "2-标注", Color = 1 },
                new { Name = "3-文字", Color = 3 },
                new { Name = "4-填充", Color = 4 }
            };

            foreach (var config in layerConfigs)
            {
                using (Perf.Timer($"创建图层_{config.Name}"))
                {
                    var layerId = Layer.Create(config.Name, (short)config.Color);
                    Log.Info($"创建图层: {config.Name} (颜色: {config.Color}) - ID: {layerId}");
                }
            }
        }

        private void ConfigureLayerProperties()
        {
            Log.Info("=== 配置图层属性 ===");
            
            // 设置不同的图层状态
            Layer.Lock("1-中心线");        // 锁定中心线图层
            Layer.Freeze("4-填充");        // 冻结填充图层
            Layer.SetColor("2-标注", 1);   // 设置标注图层为红色
            
            Log.Info("图层属性配置完成");
        }

        private void ManageLayerStates()
        {
            Log.Info("=== 图层状态管理 ===");
            
            // 设置当前图层
            if (Layer.Exists("0-外框"))
            {
                Layer.SetCurrent("0-外框");
                Log.Info("当前图层设置为: 0-外框");
            }
            
            // 解锁图层
            Layer.Unlock("1-中心线");
            Log.Info("中心线图层已解锁");
            
            // 解冻图层
            Layer.Thaw("4-填充");
            Log.Info("填充图层已解冻");
        }

        private void DisplayLayerInfo()
        {
            Log.Info("=== 图层信息统计 ===");
            
            var allLayerNames = Layer.GetNames().ToList();
            Log.Info($"总图层数: {allLayerNames.Count}");
            
            foreach (var layerName in allLayerNames.Where(name => name.StartsWith("0-") || name.StartsWith("1-")))
            {
                Log.Info($"图层: {layerName}");
            }
        }

        private void CleanupTestLayers()
        {
            Log.Info("=== 清理测试图层 ===");
            
            var testLayers = new[] { "1-中心线", "2-标注", "3-文字", "4-填充" };
            
            foreach (var layerName in testLayers)
            {
                if (Layer.Exists(layerName))
                {
                    var deleted = Layer.Delete(layerName);
                    Log.Info($"删除图层 {layerName}: {(deleted ? "成功" : "失败")}");
                }
            }
        }
    }
}
```

## 🎯 **使用建议**

### ✅ **推荐的使用模式**

1. **新项目**: 优先使用 `ARX.ARXLayer.*` 统一API
2. **现有项目**: 保持原有代码不变，新功能使用新API
3. **性能关键**: 使用性能监控包装重要操作
4. **企业应用**: 结合事件系统实现业务逻辑

### 🚀 **立即体验**

```csharp
// 最简单的开始方式
using DotNetARX;

// 一行代码创建图层
var layerId = ARX.ARXLayer.Create("我的图层", 2);

// 一行代码设置当前图层  
ARX.ARXLayer.SetCurrent("我的图层");

// 完成！
```

---

**新框架提供了向后兼容的同时，还增加了更强大的功能：性能监控、事件处理、异常管理、日志记录等企业级特性。**